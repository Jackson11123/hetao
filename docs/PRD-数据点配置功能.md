# 数据点配置功能 PRD

## 1. 背景

当前OJ系统创建题目时，需要手动配置评测数据点，操作繁琐且容易出错。为提升出题效率，需要支持通过上传题目包自动解析数据点配置，减少人工操作。

## 2. 目标

1. 支持上传题目包（.zip格式），自动解析题目信息和数据点配置
2. 提供可视化的数据点分组管理界面
3. 支持灵活的计分方式配置

## 3. 详细需求

| 功能 | 原型 | 需求描述 |
|------|------|----------|
| 上传方式选择 | ![上传方式](上传方式选择.png) | **上传方式切换**<br>1. 提供两种上传方式：上传题目包(.zip)、上传数据包(.zip)<br>2. 两种方式可随时切换，新上传会覆盖旧数据<br>3. 上传题目包支持解析完整题目信息<br>4. 上传数据包仅解析数据点文件 |
| 文件选择浮层 | ![文件选择](文件选择浮层.png) | **文件选择功能**<br>1. 上传题目包后弹出文件选择浮层<br>2. 以树形结构展示压缩包内文件和文件夹<br>3. 文件夹支持展开/收起，显示文件夹图标<br>4. 文件显示文件图标和文件大小<br>5. 支持复选框选择，选择文件夹则全选该文件夹下所有文件<br>6. 点击"确认导入"解析选中文件 |
| 题目信息解析 | - | **problem.yaml 解析**<br>1. 解析 title 字段，填充到题目配置的标题输入框<br><br>**problem_zh.md 解析**<br>1. 解析 Markdown 内容，填充到题目描述<br>2. 右侧预览区域实时渲染 Markdown 格式 |
| 数据点配置解析 | ![数据点配置](数据点配置.png) | **config.yaml 解析**<br>1. 解析 time 字段（如 2000ms），设置所有数据点的时间限制<br>2. 解析 memory 字段（如 512MB），设置所有数据点的内存限制<br>3. 解析 subtasks 数组，生成小组列表<br>4. 每个 subtask 的 id 对应小组编号（id:1 → 小组1）<br>5. 每个 subtask 的 score 对应小组总分<br>6. 每个 subtask 的 type 对应计分方式（min/max/sum → MIN/MAX/SUM）<br>7. 每个 subtask 的 if 数组对应前置依赖<br>8. 每个 subtask 的 cases 数组对应数据点列表<br>9. 数据点分值 = 小组总分 / 数据点数量 |
| 数据点配置表格 | ![表格](数据点表格.png) | **表格结构**<br>1. 列：编号、数据点、时间限制(ms)、内存限制(mb)、栈限制(mb)、分值、计分方式、操作<br>2. 小组行：编号显示"小组X"，数据点列显示前置依赖输入框，分值显示小组总分（带"分"后缀），计分方式显示下拉选择，操作显示"删除小组"<br>3. 数据点行：编号显示序号，数据点显示文件名，分值显示单个数据点分值，计分方式为空<br>4. 小组行背景色区分（浅灰色）<br>5. 支持批量选择数据点（复选框） |
| 计分方式 | - | **计分方式选项**<br>1. SUM：小组内所有数据点得分求和<br>2. MAX：取小组内数据点最高得分<br>3. MIN：取小组内数据点最低得分 |
| 添加小组 | - | **添加小组功能**<br>1. 点击"+ 添加小组"按钮新增空白小组<br>2. 新小组默认：时间限制1000ms，内存限制128mb，栈限制128mb，分值0分，计分方式SUM |
| 批量移动数据点 | - | **批量操作**<br>1. 选择数据点后，点击"批量移动数据点"按钮<br>2. 可将选中数据点移动到其他小组 |

## 4. 文件格式说明

### 4.1 题目包结构
```
题目包.zip
├── additional_file/          # 附加文件目录
│   ├── a_sample1.in
│   ├── a_sample1.out
│   └── ...
├── testdata/                 # 测试数据目录
│   ├── config.yaml          # 数据点配置文件
│   ├── a1-1.in
│   ├── a1-1.out
│   └── ...
├── problem.yaml             # 题目元信息
└── problem_zh.md            # 题目描述（Markdown）
```

### 4.2 problem.yaml 格式
```yaml
pid: P97
owner: 82999
title: 圣诞树回收计划
tag:
  - T1
nSubmit: 2
nAccept: 3
```

### 4.3 config.yaml 格式
```yaml
type: default
time: 2000ms
memory: 512MB
subtasks:
  - score: 8
    if: []
    id: 1
    type: min
    cases:
      - input: a1-1.in
        output: a1-1.out
      - input: a1-2.in
        output: a1-2.out
  - score: 36
    if:
      - 1
    id: 2
    type: sum
    cases:
      - input: a2-1.in
        output: a2-1.out
```

## 5. 交互说明

1. 用户进入"数据点配置"Tab
2. 选择上传方式（题目包/数据包）
3. 点击上传按钮，选择 .zip 文件
4. 上传成功后弹出文件选择浮层
5. 用户勾选需要导入的文件
6. 点击"确认导入"，系统解析文件并填充表单
7. 用户可在表格中调整各项配置
8. 点击"保存"提交配置

## 6. 版本记录

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-01-07 | 初始版本 | - |
